"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.convertTime=exports.getKeys=exports.messageErrors=exports.cloneDeep=exports.merge=exports.isArr=exports.isStr=exports.isObj=void 0;const getKeys=a=>{let b=[];for(let c in a)c&&b.push(c);return b};exports.getKeys=getKeys;const isObj=a=>a&&a.constructor==Object;exports.isObj=isObj;const isStr=a=>a&&a.constructor==String;exports.isStr=isStr;const isArr=a=>a&&a.constructor==Array;exports.isArr=isArr;const cloneDeep=a=>JSON.parse(JSON.stringify(a));exports.cloneDeep=cloneDeep;const merge=(a,b,c)=>{if(!a&&!b)return null;if(!a)return b;if(!b)return a;if(isObj(a)&&isObj(b)){var d={},e=getKeys(a),f=getKeys(b);return e.forEach(e=>{d[e]=merge(a[e],b[e],c)}),f.forEach(f=>{e.includes(f)||(d[f]=merge(a[f],b[f],c))}),d}if(isArr(a)&&isArr(b)){let d;return c?d=a.concat(b):(d=[...a],b.forEach(a=>{d.includes(a)||d.push(a)})),d}return b};exports.merge=merge;const messageErrors={inLine:a=>`Erro na linha ${a}`,invalidCommand:(a,b)=>`Sintaxe incorreta: ${a}
Comando "${b}" não identificado.`,invalidElement:(a,b)=>`Sintaxe incorreta: ${a}
Elemento "${b}" inválido.`,invalidResponse:(a,b)=>`Sintaxe incorreta: ${a}
Resposta "${b}" inválida.`,invalidConsequence:(a,b)=>`Sintaxe incorreta: ${a}
Consequência "${b}" inválida.`,invalidPoints:a=>`Sintaxe incorreta: ${a}
A quantidade de pontos parece incorreta.`,invalidContingence:a=>`Sintaxe incorreta: ${a}
Contingência "${a}" inválida.`,invalidContingenceInterval:a=>`Sintaxe incorreta: ${a}
Intervalo de contingência inválido: "${a}"`,undefinedElement:a=>`Erro semântico, o elemento "${a}" não existe`,invalidInput:a=>`Entrada inválida ${a}`,codeError:a=>`Erro no código:
  ${a.join("\n")}`,alreadyStarted:()=>`O app já foi iniciado`,notAlreadyStarted:()=>`O app não foi iniciado`,bug:a=>`Erro catastrófico! ${a}`};exports.messageErrors=messageErrors;const convertTime=(a,b)=>"ms"===b?a:"s"===b?1e3*a:"m"===b?6e4*a:void 0;exports.convertTime=convertTime;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.interpreter=exports.createMachine=void 0;var _helpers=require("./helpers"),_wordbook=require("./wordbook"),_parsers=require("./parsers");const defaultState={initialized:null,counters:{},intervals:{},variables:{},timer:null,elapsed:0,history:[]},createMachine=(a,b=200)=>{if(0<a.errors.length)return function(){return{error:_helpers.messageErrors.codeError(a.errors),run:null,data:a}};var c=(0,_helpers.cloneDeep)(defaultState),d=_wordbook.validAppCmds.concat(a.responses);c.timer=setInterval(()=>{if(c.initialized){for(let a in c.intervals)a&&(c.intervals[a]+=-b,0>c.intervals[a]&&(c.intervals[a]=0));c.elapsed=Date.now()-c.history[0].at}},b);const e=function(b){let e={error:null,run:null,elapsed:c.elapsed,at:Date.now(),history:null};if(!d.includes(b))return e.error=_helpers.messageErrors.invalidInput(b.toString()),e;switch(b){case"INIT":if(!c.initialized)c.initialized=!0;else return e.error=_helpers.messageErrors.alreadyStarted(),e;return a.controllers.forEach(a=>{c.counters[a.input]=0,a.runAfter.time&&(c.intervals[a.input]=(0,_helpers.convertTime)(a.runAfter.time,a.runAfter.unit))}),e.run="INIT",c.history.push((0,_helpers.cloneDeep)(e)),e;case"RESET":return e.error="BUG",e;break;case"FINISH":return c.initialized?(e.run="FINISH",c.history.push((0,_helpers.cloneDeep)(e)),e.history=c.history,clearInterval(c.timer),e):(e.error=_helpers.messageErrors.notAlreadyStarted(),e);}if(!c.initialized)return e.error=_helpers.messageErrors.notAlreadyStarted(),e;c.counters[b]+=1;let f=null;return a.controllers.forEach(a=>{a.input==b&&(1==a.runAfter.attempts?f=a.output:1<a.runAfter.attemprs&&c.counters[b]==a.runAfter.attempts&&(c.counters[b]=0,f=a.output)),e.run=f}),f&&c.history.push((0,_helpers.cloneDeep)(e)),e};return e.state=c,e};exports.createMachine=createMachine;const interpreter=a=>{const b=(0,_parsers.codeParser)(a),c=(0,_parsers.semanticAnalyse)(b);return createMachine(c)};exports.interpreter=interpreter;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.tokenizer=exports.lineTokenizer=exports.splitCode=exports.cleanCode=exports.tokenize=exports.Type=void 0;var Type;exports.Type=Type,function(a){a[a.Response=0]="Response",a[a.Contingence=1]="Contingence",a[a.Consequence=2]="Consequence",a[a.Condition=3]="Condition",a[a.Error=4]="Error"}(Type||(exports.Type=Type={}));const cleanCode=a=>a.replace(/\#.+\n/g,"\n").replace(/ +/g,"").replace(/\n{2,}/g,"\n");exports.cleanCode=cleanCode;const splitCode=a=>a.split(/\n/g).filter(a=>a);exports.splitCode=splitCode;const lineTokenizer=a=>{let b={text:a,type:Type.Error};return /^R\d+=/.test(a)?b.type=Type.Response:/^C\d+=/.test(a)?b.type=Type.Consequence:/^&\d+=/.test(a)?b.type=Type.Contingence:/^@\d+=/.test(a)&&(b.type=Type.Condition),b};exports.lineTokenizer=lineTokenizer;const tokenizer=a=>a.map((a,b)=>lineTokenizer(a,b));exports.tokenizer=tokenizer;const tokenize=a=>tokenizer(splitCode(cleanCode(a)));exports.tokenize=tokenize;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.semanticAnalyse=exports.codeParser=void 0;var _lexers=require("./lexers"),_helpers=require("./helpers"),_wordbook=require("./wordbook");const responseParser=a=>{var b=a.split("=");const c=b[0],d=b[1].split("."),e=d[0],f=d[1],g=d[2];var h=(0,_helpers.cloneDeep)(_wordbook.defaultData);return 2==d.length?_wordbook.validEvents.includes(d[1])?h.events[d[1]].push(c):h.errors.push(_helpers.messageErrors.invalidCommand(a,d[1])):3==d.length?_wordbook.validInterfaceElements.includes(e)?_wordbook.validEvents.includes(g)?(h.events[g].push(`${f}:${c}`),!h.interface[e].includes(f)&&h.interface[e].push(f)):h.errors.push(_helpers.messageErrors.invalidResponse(a,g)):h.errors.push(_helpers.messageErrors.invalidElement(a,e)):h.errors.push(_helpers.messageErrors.invalidPoints(a)),h.responses.includes(c)||h.responses.push(c),h},consequenceParser=a=>{const b=a.split("="),c=b[0];var d=(0,_helpers.cloneDeep)(_wordbook.defaultData),e=b[1].split("|").map(a=>a.split("."));return d.actions[c]=[],e.forEach(b=>{const e=b[0],f=b[1],g=b[2];2==b.length?_wordbook.validActions.includes(b[1])?d.actions[c].push(`app:${b[1]}`):d.errors.push(_helpers.messageErrors.invalidCommand(a,b[1])):3==b.length?_wordbook.validActions.includes(g)?(d.actions[c].push(`${f}:${g}`),!d.interface[e].includes(f)&&d.interface[e].push(f)):d.errors.push(_helpers.messageErrors.invalidConsequence(a,g)):d.errors.push(_helpers.messageErrors.invalidPoints(a))}),d},hasInterval=/-(\d+)([ms]{1,2})$/,hasReason=/\*(\d+)$/,hasMany=/\|/,contingenceParser=a=>{let b=(0,_helpers.cloneDeep)(_wordbook.defaultData),c={input:null,output:null,runAfter:{attempts:1,time:0,timeUnit:null}};try{const d=a.split("=")[1].split(/->/);let e=d[0],f=d[1];hasInterval.test(e)&&(e=e.replace(hasInterval,(d,e,f)=>(e=+e,e&&_wordbook.validTimeUnits.includes(f)?(c.runAfter.time=e,c.runAfter.timeUnit=f):b.errors.push(_helpers.messageErrors.invalidContingenceInterval(a)),""))),hasReason.test(e)&&(e=e.replace(hasReason,(d,e)=>(e=+e,e?c.runAfter.attempts=e:b.errors.push(_helpers.messageErrors.invalidContingenceInterval(a)),""))),c.input=e,f=hasMany.test(f)?f.split("|"):[f],c.output=f,b.controllers.push(c)}catch(c){b.errors.push(_helpers.messageErrors.invalidContingence(a))}return b},codeParser=a=>{var b=(0,_helpers.cloneDeep)(_wordbook.defaultData);return a.forEach(a=>{var c;switch(a.type){case _lexers.Type.Response:c=responseParser(a.text);break;case _lexers.Type.Consequence:c=consequenceParser(a.text);break;case _lexers.Type.Contingence:c=contingenceParser(a.text);break;case _lexers.Type.Error:c={errors:b.errors.concat([_helpers.messageErrors.inLine(a.text)])};}c?b=(0,_helpers.merge)(b,c):c={errors:b.errors.concat([_helpers.messageErrors.bug(a.text)])}}),b};exports.codeParser=codeParser;const semanticAnalyse=a=>{let b=(0,_helpers.cloneDeep)(a);const c=(0,_helpers.getKeys)(b.actions);return a.controllers.forEach(a=>{b.responses.includes(a.input)||b.errors.push(_helpers.messageErrors.undefinedElement(a.input)),a.output.forEach(d=>{c.includes(d)||b.errors.push(_helpers.messageErrors.undefinedElement(a.output))})}),b};exports.semanticAnalyse=semanticAnalyse;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.validAppCmds=exports.validInterfaceElements=exports.validTimeUnits=exports.validEvents=exports.validActions=exports.defaultData=void 0;const validInterfaceElements=["screen","button","message","app","counter"];exports.validInterfaceElements=validInterfaceElements;const validActions=["show","enable","disable","hide","reset","finish"];exports.validActions=validActions;const validEvents=["click","init","finish"];exports.validEvents=validEvents;const validTimeUnits=["s","m","ms"];exports.validTimeUnits=validTimeUnits;const validAppCmds=["INIT","RESET","FINISH"];exports.validAppCmds=validAppCmds;const defaultData={events:{init:[],finish:[],click:[]},interface:{button:[],message:[],counter:[],screen:[]},actions:{},errors:[],controllers:[],responses:[]};exports.defaultData=defaultData;
